<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 3.6.10">
  <meta charset="utf-8">
  <title>Source: eventSourcing/Event.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">Home</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: eventSourcing/Event.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>/* this file describes the expected events schema for events
 * published from the workflow engine to the cloud */
const Joi &#x3D; require(&#x27;joi&#x27;)

/**
 *  @namespace EventSourcing
 */

const TYPES &#x3D; {
  /* everyday events dispatched from normal execution */

  EVENT_RECEIVED: &#x27;EVENT_RECEIVED&#x27;,
  FLOW_SIGNALED: &#x27;FLOW_SIGNALED&#x27;,
  PHASE_STARTED: &#x27;PHASE_STARTED&#x27;,
  GATEWAY_ACTIVATED: &#x27;GATEWAY_ACTIVATED&#x27;,

  /* answers to user requested interventions */
  WORKFLOW_PAUSED: &#x27;WORKFLOW_PAUSED&#x27;,
  WORKFLOW_RESUMED: &#x27;WORKFLOW_RESUMED&#x27;,
  WORKFLOW_TERMINATED: &#x27;WORKFLOW_TERMINATED&#x27;,

  /* events coming from explicitly modelled event dispatchers */

  /* &#x27;WORKFLOW FINISHED&#x27; comes from the EndEvent dispatcher
  /* when the workflow finishes correctly (as is not &#x27;terminated&#x27;) */
  WORKFLOW_FINISHED: &#x27;WORKFLOW_FINISHED&#x27;,
}

const BASE_SCHEMA &#x3D; Joi.object({
  type: Joi.sring().valid(...Object.values(TYPES)).required(),
  createdAt: Joi.number().integer().strict().min(0)
    .required(),
})

const DATA_SCHEMAS &#x3D; {
  /**
  * @typedef {object} EventReceivedEventData
  * @memberof EventSourcing
  * @property {string} eventListenerId - ID of the event listener
  * @property {boolean} [forced&#x3D;false] - indicates if an event listener was forced to trigger
  */
  [TYPES.EVENT_RECEIVED]: Joi.object({
    eventListenerId: Joi.string().required(),
    forced: Joi.boolean().strict().default(false),
  }),
  /**
  * @typedef {object} FlowSignaledEventData
  * @memberof EventSourcing
  * @property {string} flowId - ID of the flow
  */
  [TYPES.FLOW_SIGNALED]: Joi.object({
    flowId: Joi.string().required(),
  }),
  /**
  * @typedef {object} PhaseStartedEventData
  * @memberof EventSourcing
  * @property {string} phaseId - ID of the phase
  */
  [TYPES.PHASE_STARTED]: Joi.object({
    phasId: Joi.string().required(),
  }),
  /**
  * @typedef {object} GatewayActivatedEventData
  * @memberof EventSourcing
  * @property {string} gatewayId - ID of the gateway
  */
  [TYPES.GATEWAY_ACTIVATED]: Joi.object({
    gatewayId: Joi.string().required(),
  }),
}

/**
* An event dispatched from the workflow engine to the cloud
* @typedef {object} DispatchedWorkflowEvent
* @memberof EventSourcing
* @property {string} type - string that indicates the event type, one of: EVENT_RECEIVED|FLOW_SIGNALED|GATEWAY_ACTIVATED|PHASE_STARTED|WORKFLOW_PAUSED|WORKFLOW_RESUMED|WORKFLOW_TERMINATED|WORKFLOW_FINISHED
* @property {number} createdAt - time since epoch (unix time) in milliseconds
* @property {object} data - required for EVENT_RECEIVED, FLOW_SIGNALED, GATEWAY_ACTIVATED and PHASE_STARTED, see data schemas
*/

const SCHEMA &#x3D; BASE_SCHEMA.concat(Joi.object({
  data: Joi.any().when(&#x27;type&#x27;,
    {
      is: TYPES.EVENT_RECEIVED,
      then: DATA_SCHEMAS[TYPES.EVENT_RECEIVED].required(),
    },
    {
      is: TYPES.PHASE_STARTED,
      then: DATA_SCHEMAS[TYPES.PHASE_STARTED].required(),
    },
    {
      is: TYPES.GATEWAY_ACTIVATED,
      then: DATA_SCHEMAS[TYPES.GATEWAY_ACTIVATED].required(),
    },
    {
      is: TYPES.FLOW_SIGNALED,
      then: DATA_SCHEMAS[TYPES.FLOW_SIGNALED].required(),
      otherwise: Joi.forbidden(),
    }),
}))

module.exports &#x3D; {
  TYPES,
  SCHEMA,
}
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 3.6.10 on March 21, 2023.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>